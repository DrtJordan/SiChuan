<#include "/common/_layout.html"/> <@layout>
<div class="top">
    <ul class="breadcrumb">
        <li><a href="admin"><i class="fa fa-home"></i> 首页</a></li>
        <li>用户分析</li>
        <li>地域分布</li>
    </ul>
</div>
<section id="content">
    <#include "/common/_dateQuery.html"/>

    <div style="margin: -20px -30px 30px -30px; background: #E0EAEC; padding-top: 20px">
        <div id="provincediv" style="height: 400px; margin: 0px 30px 0px 30px;"></div>
    </div>

    <div class="clear">
        <hr/>
    </div>

    <div class="panel panel-default">
        <header class="panel-heading">
            <i class="fa-map-marker fa"></i>&nbsp;地域分布<span class="hidden-sm pull-right">
			<a href="" csvAction="/csv/portal_siteAnalysis_area_query" class="csvExport btn btn-default btn-sm"
               style="display: inline"><i class="fa fa-cloud-download"></i>&nbsp;导出</a></span>
        </header>

        <div class="table-responsive">
            <table id="table" class="table_select_row datatables table table-striped m-b-none"
                   style="border-top: 0px"
                   data-ride="datatables">
                <thead>
                <tr>
                    <th class="w-2">城市</th>
                    <th class="w-4">日期</th>
                    <th class="w-2">访客</th>
                    <th class="w-3">UV占比</th>
                    <th class="w-2">PV</th>
                    <th class="w-2">VV</th>
                    <th class="w-2">IP数</th>
                    <th class="w-3">新访客</th>
                    <th class="w-4">新访客占比</th>
                    <th class="w-4">平均深度</th>
                    <th class="w-2">登录</th>
                    <th class="w-5">登录/访客数</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="clear">
        <hr/>
    </div>

</section>
</@layout>

<script>
    /**
     * 隐藏按周汇总的按钮
     */
    $().ready(function () {
        $("#weekButton").hide();
    })
</script>
<script>
    /**
     * 定义数据查询方法，用来转换后台传输数据
     * @param data 数据
     * @param dateType 日期类型：day,week,month,quarter,year
     */
    function dataTableExchange(data, dateType) {

        var chart = echarts.init(
            document.getElementById('provincediv'), 'macarons');
        var chartOption = data.chartOption;
        var option = $.parseJSON(chartOption);

        tableQuery({
            "aaData": data.areaData
        });
        csvExport("", dateType);

        var ecConfig = echarts.config;
        var curIndx = 0;
        var mapType = [
            'china',
            // 23个省
            '广东', '青海', '四川', '海南', '陕西',
            '甘肃', '云南', '湖南', '湖北', '黑龙江',
            '贵州', '山东', '江西', '河南', '河北',
            '山西', '安徽', '福建', '浙江', '江苏',
            '吉林', '辽宁', '台湾',
            // 5个自治区
            '新疆', '广西', '宁夏', '内蒙古', '西藏',
            // 4个直辖市
            '北京', '天津', '上海', '重庆',
            // 2个特别行政区
            '香港', '澳门'
        ];
        chart.on(ecConfig.EVENT.MAP_SELECTED, function (param){
            var len = mapType.length;
            var mt = mapType[curIndx % len];
            if (mt == 'china') {
                // 全国选择时指定到选中的省份
                var selected = param.selected;
                for (var i in selected) {
                    if (selected[i]) {
                        mt = i;
                        while (len--) {
                            if (mapType[len] == mt) {
                                curIndx = len;
                            }
                        }
                        break;
                    }
                }
                option.tooltip.formatter = '点击返回全国<br/>{b}';
            }
            else {
                curIndx = 0;
                mt = 'china';
                option.tooltip.formatter = '点击进入该省<br/>{b}';
            }
            option.series[0].mapType = mt;
            option.title.subtext = mt + ' （点击切换）';
            chart.setOption(option, true);
        });

        chart.setOption(option);
    }

</script>
